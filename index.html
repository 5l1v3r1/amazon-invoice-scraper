<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Amazon Invoice Generator by sudiptakarmakar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Amazon Invoice Generator</h1>
      <h2 class="project-tagline">A repository for maintaining amazon orders and invoices automatically</h2>
      <a href="https://github.com/sudiptakarmakar/amazon-invoice-scraper" class="btn">View on GitHub</a>
      <a href="https://github.com/sudiptakarmakar/amazon-invoice-scraper/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/sudiptakarmakar/amazon-invoice-scraper/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p></p><h1>
<a id="amazon-invoice-automation-private-repository" class="anchor" href="#amazon-invoice-automation-private-repository" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Amazon Invoice Automation (Private Repository)</h1>

<hr>

<h2>
<a id="log-into-amazon" class="anchor" href="#log-into-amazon" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Log into Amazon</h2>

<p>Log into Amazon using the following base snippet. Store data in session which you can use for future queries. Check response content to determine if its a successful login.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-c">#!/usr/bin/env python3</span>
<span class="pl-k">import</span> requests

session <span class="pl-k">=</span> requests.Session()
data <span class="pl-k">=</span> {<span class="pl-s"><span class="pl-pds">'</span>email<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>email_id@gmail.com<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>:<span class="pl-s"><span class="pl-pds">'</span>password<span class="pl-pds">'</span></span>}
header<span class="pl-k">=</span>{<span class="pl-s"><span class="pl-pds">'</span>User-Agent<span class="pl-pds">'</span></span> : <span class="pl-s"><span class="pl-pds">'</span>Mozilla/5.0<span class="pl-pds">'</span></span>}

response <span class="pl-k">=</span> session.post(<span class="pl-s"><span class="pl-pds">'</span>https://www.amazon.com/gp/sign-in.html<span class="pl-pds">'</span></span>, data, <span class="pl-v">headers</span><span class="pl-k">=</span>header)
<span class="pl-k">return</span> response.content</pre></div>

<h2>
<a id="scrape-order-details-page-for-order-numbers" class="anchor" href="#scrape-order-details-page-for-order-numbers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scrape Order Details Page for Order Numbers</h2>

<h3>
<a id="go-to-page" class="anchor" href="#go-to-page" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Go to page</h3>

<p>After successful login, go to order details page
<code>https://www.amazon.com/gp/css/order-history</code>.</p>

<blockquote>
<p>By default it will load order details for last 6 months which is sufficient for monthly automated invoice preparation. If required more, you can change some query parameters easily to suit your needs.</p>
</blockquote>

<h3>
<a id="count-number-of-orders" class="anchor" href="#count-number-of-orders" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Count number of orders</h3>

<h3>
<a id="scrape-invoice-links" class="anchor" href="#scrape-invoice-links" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Scrape Invoice links</h3>

<p>Next find out all anchor tags with <code>Invoice</code> text inside them as well as a link that points to <code>https://www.amazon.com/gp/css/summary/print.html/ref=oh_aui_pi_o00_?orderID=123-1234567-1234567</code>, where order number is given by <code>123-1234567-1234567</code>. In the link, base url (<code>//www.amazon.com</code>) might be omitted; so look for <code>/gp/css/summary/print.html/ref=oh_aui_pi_o00_</code>.</p>

<p>One sample link looks like: <code>&lt;a class="a-link-normal" href="/gp/css/summary/print.html/ref=oh_aui_pi_o00_?ie=UTF8&amp;amp;orderID=123-1234567-1234567"&gt;Invoice&lt;/a&gt;</code></p>

<h3>
<a id="look-into-multiple-pages" class="anchor" href="#look-into-multiple-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Look into multiple pages</h3>

<p>Number of orders might be more than 10 and hence we need to deal with pagination issues.</p>

<p>This is the url when I click page 2: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_1_2?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=10</code></p>

<p>This is the url for page 3: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_2_3?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=20</code></p>

<p>Explicit click to page 1: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_3_1?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=0</code></p>

<p>Clicking on <code>next</code> from page 1 to 2: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_1_2?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=10</code></p>

<p>Clicking on <code>next</code> from page 2 to 3: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_2_3?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=20</code></p>

<p>Clicking on <code>previous</code> from page 3 to 2: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_3_2?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=10</code></p>

<p>Clicking on <code>previous</code> from page 2 to 1: <code>https://www.amazon.com/gp/your-account/order-history/ref=oh_aui_pagination_2_1?ie=UTF8&amp;orderFilter=months-6&amp;search=&amp;startIndex=0</code></p>

<p>Scrape invoices (order numbers and corresponding links) till you hit the total invoice number found on first <code>order history</code> page all while discarding duplicate entries.</p>

<h2>
<a id="go-to-order-invoice-page" class="anchor" href="#go-to-order-invoice-page" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Go to order invoice page</h2>

<p>Next, using the already stored <code>requests.Session</code> go to the invoice urls one by one. Sample url: <code>https://www.amazon.com/gp/css/summary/print.html/ref=oh_aui_pi_o00_?orderID=123-1234567-1234567</code></p>

<div class="highlight highlight-source-python"><pre>invoice_url <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>https://www.amazon.com/gp/css/summary/print.html/ref=oh_aui_pi_o00_?orderID=123-1234567-1234567<span class="pl-pds">'</span></span>
response <span class="pl-k">=</span> session.post(invoice_url, data, <span class="pl-v">headers</span><span class="pl-k">=</span>header)

<span class="pl-k">return</span> response.content</pre></div>

<h2>
<a id="print-the-invoices" class="anchor" href="#print-the-invoices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Print the Invoices</h2>

<p>You already have the response content or, the html content returned by amazon for that particular order number. Simply use that with the help of <code>pdfkit</code> to save file as a pdf with possibly the order number as part of filename.</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> pdfkit

order_id <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>123-1234567-1234567<span class="pl-pds">'</span></span>
pdf_file <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>invoice_<span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-c1">str</span>(order_id) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>.pdf<span class="pl-pds">'</span></span>
html_content <span class="pl-k">=</span> response.content

<span class="pl-c"># pdfkit.from_url('http://amazon.com/...', pdf_file)</span>
<span class="pl-c"># pdfkit.from_file('test.html', pdf_file)</span>
pdfkit.from_string(html_content, pdf_file)</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/sudiptakarmakar/amazon-invoice-scraper">Amazon Invoice Generator</a> is maintained by <a href="https://github.com/sudiptakarmakar">sudiptakarmakar</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
